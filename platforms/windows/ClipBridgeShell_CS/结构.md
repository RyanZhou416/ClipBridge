# 顶层结构（3 个项目）

* **ClipBridgeShell\_CS**：UI 应用（WinUI 3，含 XAML、导航、设置、打包文件）。
* **ClipBridgeShell\_CS.Core**：**纯 .NET 类库**（放可测试的业务逻辑/模型/服务；默认给了示例数据服务）。
* **ClipBridgeShell\_CS.Tests.MSTest**：单元测试项目（MSTest）。

# 应用项目 ClipBridgeShell\_CS

**入口与全局**

* `App.xaml / App.xaml.cs`：应用启动、主题、激活流程（会调用 Services 里的 ActivationService）。
* `MainWindow.xaml / .cs`：顶层窗口（只做 TitleBar/Host，真正的页面导航在 ShellPage）。
* `Package.appxmanifest / app.manifest / Package.appinstaller`：MSIX 包、应用身份与能力声明。
* `appsettings.json`：本地设置的默认值（LocalSettingsService 会读写）。

**导航与激活**

* `Views/ShellPage.xaml(.cs)`：侧边栏导航容器（`NavigationView` + `Frame`），切页在这发生。
* `Services/NavigationService.cs`：封装 `Frame` 导航；`NavigationViewService.cs`：把菜单项映射到页面类型。
* `Activation/*`：应用激活管线（冷启动/文件激活/通知激活等）。通常不改，但你若要支持协议/文件激活，这里扩展 Handler。

**页面与 VM**

* `Views/MainPage, DevicesPage, LogsPage, SettingsPage` + 对应 `ViewModels/*ViewModel.cs`：模板已帮你建好 MVVM 绑定关系。

    * `MainViewModel`：适合做仪表盘（Core 初始化状态、最近 Item、快捷按钮）。
    * `DevicesViewModel`：设备列表/详情。
    * `LogsViewModel`：日志滚动输出。
    * `SettingsViewModel`：读取/保存本地设置（调用 `LocalSettingsService`）。
* `Contracts/ViewModels/INavigationAware.cs`：页面切换时的 OnNavigatedTo/From 钩子。

**服务层（可直接接你内核）**

* `Services/*`：模板内置的一些横切服务：

    * `ActivationService`：应用启动协作器。
    * `AppNotificationService`：系统通知。
    * `LocalSettingsService`：读写 `appsettings.json` 和 `ApplicationData.LocalSettings`。
    * `ThemeSelectorService`：主题/浅深色切换。
    * `PageService`：页面类型注册。
* 👉 你要新增：

    * `Services/CoreHostService.cs`：通过 **P/Invoke** 调 `core_ffi_windows.dll`（`cb_init/ingest/shutdown` 等），把回调转成 C# 事件/消息。
    * `Services/ClipboardService.cs`：订阅 `Windows.ApplicationModel.DataTransfer.Clipboard.ContentChanged`，生成 snapshot JSON，调用 `CoreHostService.IngestLocalCopy`，把 `itemId` 分发给 VM。
    * `Interop/CoreNative.cs`：集中放 `[DllImport]` 和委托/结构体编组（UTF-8 字符串用 `UnmanagedType.LPUTF8Str`）。

**UI 资源**

* `Styles/*`：TextBlock、间距、字号等样式字典（全局资源）。
* `Strings/en-us/Resources.resw`：本地化字符串。
* `Assets/*`：应用图标、启动图等。

# 核心类库 ClipBridgeShell\_CS.Core

* `Models/*`：示例模型（可删或替换成你自己的，如 `ClipboardItem`, `DeviceInfo`）。
* `Services/*`：示例数据与文件服务（可以作为你自己服务的参考/测试替身）。
* `Helpers/Json.cs`：System.Text.Json 包装（可直接复用）。

> 建议把**与 UI 无关**、可单测的逻辑放到这个项目里（如历史列表管理、配置校验、JSON 构造与转义等），UI 项目通过接口引用它，测试项目也能直接测。

# 测试项目 ClipBridgeShell\_CS.Tests.MSTest

* `Initialize.cs`：测试初始化钩子。
* `TestClass.cs`：示例测试类。
* 这里可以写：

    * **Snapshot JSON 生成**与转义测试。
    * **CoreHostService** 的轻量 stub 测试（用 Fake DLL 或抽象接口注入）。
    * **ViewModel** 的状态变化测试（不依赖 UI 线程）。

# 打包/运行

* **MSIX**：用 `Package.appxmanifest` 配置图标、显示名、协议；右键项目 → *Package and Publish* 即可出包。
* **未打包便携**：如果你勾了 *Self-Contained*，会在 `bin\publish` 下得到可拷贝运行的产物（不需要证书/安装器）。

