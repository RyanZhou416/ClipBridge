<Page x:Class="ClipBridgeShell_CS.Views.ShellPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:helpers="using:ClipBridgeShell_CS.Helpers"
      xmlns:behaviors="using:ClipBridgeShell_CS.Behaviors"
      xmlns:i="using:Microsoft.Xaml.Interactivity"
      xmlns:l="using:WinUI3Localizer"
      Loaded="OnLoaded">
    <Grid>
		<Grid.RowDefinitions>
			<!-- 0: TitleBar（用 CompactPaneLength 作为高度） -->
			<RowDefinition Height="{Binding ElementName=NavigationViewControl, Path=CompactPaneLength}" />
			<!-- 1: Degraded InfoBar -->
			<RowDefinition Height="Auto" />
		</Grid.RowDefinitions>

		<!-- Titlebar -->
		<Grid x:Name="AppTitleBar"
		Grid.Row="0"
		Canvas.ZIndex="1"
		Height="{Binding ElementName=NavigationViewControl, Path=CompactPaneLength}"
		IsHitTestVisible="True"
		Background="Transparent"
		VerticalAlignment="Top">
            <Image Source="/Assets/WindowIcon.ico" HorizontalAlignment="Left" Width="16" Height="16" />
            <TextBlock x:Name="AppTitleBarText" VerticalAlignment="Center" TextWrapping="NoWrap" Style="{StaticResource CaptionTextBlockStyle}" Margin="28,0,0,0"/>
        </Grid>

		<!-- Global degraded banner -->
		<InfoBar Grid.Row="1"
         IsOpen="{x:Bind ViewModel.IsCoreDegraded, Mode=OneWay}"
         IsClosable="True"
         Severity="Error"
         Title="Core unavailable"
         Message="{x:Bind ViewModel.CoreDegradedMessage, Mode=OneWay}">

			<InfoBar.ActionButton>
				<DropDownButton Content="Actions">
					<DropDownButton.Flyout>
						<MenuFlyout>
							<MenuFlyoutItem Text="Retry"
                                    Command="{x:Bind ViewModel.RetryCoreInitCommand}" />
							<MenuFlyoutSeparator />
							<MenuFlyoutItem Text="Copy diagnostics"
                                    Command="{x:Bind ViewModel.CopyDiagnosticsCommand}" />
							<MenuFlyoutItem Text="Open Logs"
                                    Command="{x:Bind ViewModel.OpenLogsCommand}" />
						</MenuFlyout>
					</DropDownButton.Flyout>
				</DropDownButton>
			</InfoBar.ActionButton>

		</InfoBar>

		<!-- NavigationView -->
		<NavigationView x:Name="NavigationViewControl"
                        Canvas.ZIndex="0"
                        IsBackButtonVisible="Visible"
                        IsBackEnabled="{x:Bind ViewModel.IsBackEnabled, Mode=OneWay}"
                        SelectedItem="{x:Bind ViewModel.Selected, Mode=OneWay}"
                        IsSettingsVisible="True"
                        IsTitleBarAutoPaddingEnabled="False"
                        Loaded="NavigationViewControl_Loaded"
                        ExpandedModeThresholdWidth="1280"
                        DisplayModeChanged="NavigationViewControl_DisplayModeChanged" >

            <NavigationView.MenuItems>
                <!-- TODO: Update item titles by updating <x:Uid>.Content entries in Strings/en-us/Resources.resw. https://docs.microsoft.com/windows/uwp/app-resources/localize-strings-ui-manifest#refer-to-a-string-resource-identifier-from-xaml TODO: Update item icons by updating FontIcon.Glyph properties. https://docs.microsoft.com/windows/apps/design/style/segoe-fluent-icons-font#icon-list -->
                <NavigationViewItem l:Uids.Uid="Shell_Main" helpers:NavigationHelper.NavigateTo="ClipBridgeShell_CS.ViewModels.MainViewModel">
                    <NavigationViewItem.Icon>
						<FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE80F;"/>
                    </NavigationViewItem.Icon>
                </NavigationViewItem>
				<NavigationViewItem l:Uids.Uid="Shell_History" helpers:NavigationHelper.NavigateTo="ClipBridgeShell_CS.ViewModels.HistoryViewModel">
					<NavigationViewItem.Icon>
						<FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE81C;"/>
					</NavigationViewItem.Icon>
				</NavigationViewItem>
				<NavigationViewItem l:Uids.Uid="Shell_Devices" helpers:NavigationHelper.NavigateTo="ClipBridgeShell_CS.ViewModels.DevicesViewModel">
                    <NavigationViewItem.Icon>
						<FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xEA6C;"/>
                    </NavigationViewItem.Icon>
                </NavigationViewItem>
				<NavigationViewItem l:Uids.Uid="Shell_Logs" helpers:NavigationHelper.NavigateTo="ClipBridgeShell_CS.ViewModels.LogsViewModel">
					<NavigationViewItem.Icon>
						<FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE756;"/>
					</NavigationViewItem.Icon>
				</NavigationViewItem>
			</NavigationView.MenuItems>
            <Grid>
                <Frame x:Name="NavigationFrame" />
            </Grid>
        </NavigationView>
        
    </Grid>
</Page>
