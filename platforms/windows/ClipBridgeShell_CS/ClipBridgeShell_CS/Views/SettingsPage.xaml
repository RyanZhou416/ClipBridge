<Page
    x:Class="ClipBridgeShell_CS.Views.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:helpers="using:ClipBridgeShell_CS.Helpers"
    xmlns:xaml="using:Microsoft.UI.Xaml"
    xmlns:l="using:WinUI3Localizer"
    mc:Ignorable="d"
    xmlns:ctk="using:CommunityToolkit.WinUI.Controls"
    xmlns:ui="using:CommunityToolkit.WinUI">
    <Page.Resources>
        <helpers:EnumToBooleanConverter x:Key="EnumToBooleanConverter" />
        <!-- 模仿 WinUI Gallery 的分组标题样式 -->
        <Style x:Key="GroupHeaderTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="0,0,0,0"/>
            <Setter Property="Margin" Value="0,0,0,0"/>
        </Style>
    </Page.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- 固定页眉 -->
            <RowDefinition Height="*"/>
            <!-- 可滚动正文 -->
        </Grid.RowDefinitions>
        <!-- Row 0: 页眉（不随滚动），与内容同一中栏 -->
        <StackPanel Grid.Row="0"
              Padding="36,24,36,4">
            <StackPanel MaxWidth="1064">
            <TextBlock l:Uids.Uid="Shell_Settings.Text" 
               Style="{StaticResource TitleTextBlockStyle}"/>
            </StackPanel>
        </StackPanel>

        <ScrollViewer Grid.Row="1"
                      Padding="36,0,36,0"
                VerticalScrollMode="Auto"
                VerticalScrollBarVisibility="Auto"
                HorizontalScrollMode="Disabled"
                HorizontalScrollBarVisibility="Disabled">
            <Border HorizontalAlignment="Stretch">
                <StackPanel x:Name="ContentArea"
                    MaxWidth="1064"
                    HorizontalAlignment="Stretch"
                    Spacing="{StaticResource SettingsGroupSpacing}"
                    Padding="0,0,0,0"
                    Margin="0,0,0,0">
                    <StackPanel Spacing="{StaticResource SettingsItemSpacing}">
                        <TextBlock l:Uids.Uid="Settings_Personalization" Style="{StaticResource GroupHeaderTextStyle}"/>
                        <!-- 主题 -->
                        <ctk:SettingsCard l:Uids.Uid="Settings_Theme"
                                          HeaderIcon="{ui:FontIcon Glyph=&#xE771;}"
                                          HorizontalAlignment="Stretch">
							<ComboBox x:Name="ThemeCombo"
									  Width="240"
									  ItemsSource="{x:Bind ViewModel.ThemeOptions, Mode=OneWay}"
									  DisplayMemberPath="Label"
									  SelectedItem="{x:Bind ViewModel.SelectedThemeOption, Mode=TwoWay}" />

						</ctk:SettingsCard>

                        <!-- 语言设置区块 -->
                        <ctk:SettingsCard l:Uids.Uid="Settings_LanguageCombo"
                                          HeaderIcon="{ui:FontIcon Glyph=&#xE8C1;}"
                                          HorizontalAlignment="Stretch">
							<ComboBox x:Name="LanguageCombo"
									  Width="240"
									  ItemsSource="{x:Bind ViewModel.LanguageOptions, Mode=OneWay}"
									  DisplayMemberPath="Label"
									  SelectedItem="{x:Bind ViewModel.SelectedLanguageOption, Mode=TwoWay}" />
						</ctk:SettingsCard>

						
										  
                    </StackPanel>

					<StackPanel Spacing="{StaticResource SettingsItemSpacing}">
						<TextBlock l:Uids.Uid="Settings_Clip" Style="{StaticResource GroupHeaderTextStyle}"/>
						<!-- 剪贴板捕获开关 -->
						<ctk:SettingsCard l:Uids.Uid="Settings_IsClipboardCaptureEnabled_SettingsCard"
										  HeaderIcon="{ui:FontIcon Glyph=&#xE8C1;}"
										  HorizontalAlignment="Stretch">
							<ToggleSwitch AutomationProperties.Name="simple ToggleSwitch"
										  IsOn="{x:Bind ViewModel.IsClipboardCaptureEnabled, Mode=TwoWay}"
										  l:Uids.Uid="Settings_IsClipboardCaptureEnabled_ToggleSwitch"/>
						</ctk:SettingsCard>

						<!-- 主页显示的卡片数量 -->
						<ctk:SettingsCard Header="主页显示的卡片数量"
										  Description="设置主页 Recent Items 区域显示的卡片数量（1-50）"
										  HeaderIcon="{ui:FontIcon Glyph=&#xE8C1;}"
										  HorizontalAlignment="Stretch">
							<NumberBox x:Name="RecentItemsCountBox"
									   Value="{x:Bind ViewModel.RecentItemsCount, Mode=TwoWay}"
									   Minimum="1"
									   Maximum="50"
									   SpinButtonPlacementMode="Inline"
									   Width="120"
									   HorizontalAlignment="Left"
									   KeyDown="RecentItemsCountBox_KeyDown"
									   LostFocus="RecentItemsCountBox_LostFocus"/>
						</ctk:SettingsCard>
					</StackPanel>

					<!-- 数据库 -->
					<StackPanel Spacing="{StaticResource SettingsItemSpacing}">
						<TextBlock l:Uids.Uid="Settings_Database" Style="{StaticResource GroupHeaderTextStyle}"/>
						<!-- 清空元数据库（core.db） -->
						<ctk:SettingsCard l:Uids.Uid="Settings_DeleteCloudDb_SettingsCard"
								  HeaderIcon="{ui:FontIcon Glyph=&#xE74D;}"
								  HorizontalAlignment="Stretch">
							<Button Click="DeleteCloudDb_Click"
							Width="180"
							l:Uids.Uid="Settings_DeleteCloudDb_Button"/>
						</ctk:SettingsCard>

						<!-- 清空统计数据库 -->
						<ctk:SettingsCard Header="清空统计数据"
								  Description="清空所有统计数据（缓存使用、网络吞吐、活动统计等）"
								  HeaderIcon="{ui:FontIcon Glyph=&#xE74D;}"
								  HorizontalAlignment="Stretch">
							<Button Click="DeleteStatsDb_Click"
							Width="180"
							Content="清空统计数据"/>
						</ctk:SettingsCard>

						<!-- 删除缓存库（CAS blobs/tmp） -->
						<ctk:SettingsCard l:Uids.Uid="Settings_DeleteCache_SettingsCard"
								  HeaderIcon="{ui:FontIcon Glyph=&#xE74D;}"
								  HorizontalAlignment="Stretch">
							<Button Click="DeleteCache_Click"
							Width="180"
							l:Uids.Uid="Settings_DeleteCache_Button"/>
						</ctk:SettingsCard>
					</StackPanel>

					<!-- Debugging -->
					<StackPanel Spacing="{StaticResource SettingsItemSpacing}">
                        <TextBlock l:Uids.Uid="Settings_Debugging" Style="{StaticResource GroupHeaderTextStyle}"/>
                        <!-- 用于显示应用文件夹路径，可删除 -->
                        <ctk:SettingsCard l:Uids.Uid="Settings_Reset_SettingsCard"
                                          HeaderIcon="{ui:FontIcon Glyph=&#xEBC4;}"
                                          HorizontalAlignment="Stretch">
                                <Button Click="ResetSettings_Click" Width="180" l:Uids.Uid="Settings_Reset_Button"/>
                        </ctk:SettingsCard>

                        <ctk:SettingsCard l:Uids.Uid="Settings_ShowLocalFolder_SettingsCard"
                                          HeaderIcon="{ui:FontIcon Glyph=&#xE71B;}"
                                          HorizontalAlignment="Stretch">
                            <Button Click="ShowLocalFolder_Click" Width="180" l:Uids.Uid="Settings_ShowLocalFolder_Button"/>
                        </ctk:SettingsCard>
                    </StackPanel>

					
					<StackPanel Spacing="{StaticResource SettingsItemSpacing}">
                        <TextBlock l:Uids.Uid="Settings_About" Style="{StaticResource GroupHeaderTextStyle}"/>
                        <TextBlock l:Uids.Uid="AppName"/>
                        <TextBlock l:Uids.Uid="Settings_AboutDescription"/>
                        <HyperlinkButton l:Uids.Uid="SettingsPage_PrivacyTermsLink" Margin="{StaticResource SettingsPageHyperlinkButtonMargin}" />
                    </StackPanel>
                </StackPanel>
            </Border>
        </ScrollViewer>
    </Grid>
</Page>
