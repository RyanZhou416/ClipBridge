<Page
    x:Class="ClipBridgeShell_CS.Views.LogsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:ClipBridgeShell_CS.Models"
    mc:Ignorable="d">

	<Grid RowDefinitions="Auto,*,Auto" Padding="12">

		<!-- 工具条 -->
		<StackPanel Orientation="Horizontal" Spacing="8">
			<ComboBox Width="120" SelectedIndex="{x:Bind VM.LevelMin, Mode=TwoWay}">
				<x:String>0 Trace+</x:String>
				<x:String>1 Debug+</x:String>
				<x:String>2 Info+</x:String>
				<x:String>3 Warn+</x:String>
				<x:String>4 Error+</x:String>
				<x:String>5 Critical+</x:String>
			</ComboBox>

			<TextBox Width="240" PlaceholderText="Filter text..." Text="{x:Bind VM.FilterText, Mode=TwoWay}" />

			<ToggleSwitch Header="Auto Scroll" IsOn="{x:Bind VM.AutoScroll, Mode=TwoWay}" />

			<Button Content="Tail" Command="{x:Bind VM.StartTailCmd}" />
			<Button Content="Stop" Command="{x:Bind VM.StopTailCmd}" />
			<Button Content="Clear View" Command="{x:Bind VM.ClearViewCmd}" />
			<Button Content="Export CSV" Command="{x:Bind VM.ExportCsvCmd}" />

			<Button Content="Delete &lt; 7 days" Command="{x:Bind VM.DeleteBeforeCmd}" />
			<Button Content="Stats" Command="{x:Bind VM.RefreshStatsCmd}" />
		</StackPanel>

		<!-- 实时/历史列表 - 多列布局用 Grid 实现 -->
		<ListView Grid.Row="1"
                  x:Name="List"
                  ItemsSource="{x:Bind VM.Items, Mode=OneWay}"
                  IsItemClickEnabled="False"
                  SelectionMode="None">
			<ListView.ItemTemplate>
				<DataTemplate x:DataType="models:LogRow">
					<Grid ColumnSpacing="8">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="80"/>
							<!-- ID -->
							<ColumnDefinition Width="150"/>
							<!-- 时间 -->
							<ColumnDefinition Width="80"/>
							<!-- 级别 -->
							<ColumnDefinition Width="80"/>
							<!-- 组件 -->
							<ColumnDefinition Width="150"/>
							<!-- 分类 -->
							<ColumnDefinition Width="*"/>
							<!-- 消息 -->
							<ColumnDefinition Width="200"/>
							<!-- 异常 -->
							<ColumnDefinition Width="200"/>
							<!-- 属性 -->
						</Grid.ColumnDefinitions>

						<!-- ID -->
						<TextBlock Grid.Column="0"
                                   Text="{x:Bind Id}" />

						<!-- 时间 -->
						<TextBlock Grid.Column="1"
                                   Text="{x:Bind TimeStr, Mode=OneWay}" />

						<!-- 级别 -->
						<TextBlock Grid.Column="2"
                                   Text="{x:Bind LevelName}" />

						<!-- 组件 -->
						<TextBlock Grid.Column="3"
                                   Text="{x:Bind Component, Mode=OneWay}" />

						<!-- 分类 -->
						<TextBlock Grid.Column="4"
                                   Text="{x:Bind Category}"
                                   Opacity="0.75" />

						<!-- 消息 -->
						<TextBlock Grid.Column="5"
                                   Text="{x:Bind Message}"
                                   TextWrapping="WrapWholeWords" />

						<!-- 异常 -->
						<TextBlock Grid.Column="6"
                                   Text="{x:Bind Exception}"
                                   TextWrapping="WrapWholeWords"
                                   Visibility="{x:Bind Exception,
                                                Converter={StaticResource StringToVisibilityConverter}}" />

						<!-- 属性 -->
						<TextBlock Grid.Column="7"
                                   Text="{x:Bind Props_Json}"
                                   TextWrapping="WrapWholeWords"
                                   Visibility="{x:Bind Props_Json,
                                                Converter={StaticResource StringToVisibilityConverter}}" />
					</Grid>
				</DataTemplate>
			</ListView.ItemTemplate>
		</ListView>

		<!-- 分页历史查询 -->
		<StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="8">
			<DatePicker Date="{x:Bind VM.RangeStart, Mode=TwoWay}" />
			<TimePicker Time="{x:Bind VM.RangeStartTime, Mode=TwoWay}" />
			<TextBlock Text="—" VerticalAlignment="Center" />
			<DatePicker Date="{x:Bind VM.RangeEnd, Mode=TwoWay}" />
			<TimePicker Time="{x:Bind VM.RangeEndTime,   Mode=TwoWay}" />
			<Button Content="Query Page" Command="{x:Bind VM.QueryPageCmd}" />
		</StackPanel>

	</Grid>
</Page>
