<Page
    x:Class="ClipBridgeShell_CS.Views.HistoryPage"
	x:Name="HistoryPageRoot"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="using:ClipBridgeShell_CS.ViewModels"
    xmlns:models="using:ClipBridgeShell_CS.Core.Models.Events"
    xmlns:l="using:WinUI3Localizer"
    mc:Ignorable="d">

	<Grid RowDefinitions="Auto,*" Padding="24">

		<Grid Grid.Row="0" ColumnDefinitions="*,Auto,Auto" Margin="0,0,0,16" ColumnSpacing="12">

			<TextBox Grid.Column="0"
                     l:Uids.Uid="HistoryPage_SearchBox"
                     Text="{x:Bind ViewModel.FilterText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

			<ComboBox Grid.Column="1" 
                      l:Uids.Uid="HistoryPage_AllTypes"
                      MinWidth="120"
                      SelectedValue="{x:Bind ViewModel.SelectedKind, Mode=TwoWay}"
                      SelectedValuePath="Tag">
				<ComboBoxItem l:Uids.Uid="HistoryPage_AllTypes" Tag="{x:Null}" IsSelected="True"/>
				<ComboBoxItem l:Uids.Uid="HistoryPage_TypeText" Tag="text"/>
				<ComboBoxItem l:Uids.Uid="HistoryPage_TypeImage" Tag="image"/>
				<ComboBoxItem l:Uids.Uid="HistoryPage_TypeFile" Tag="file"/>
			</ComboBox>

			<Button Grid.Column="2" Command="{x:Bind ViewModel.RefreshCommand}">
				<FontIcon Glyph="&#xE72C;" />
			</Button>
		</Grid>

		<ListView Grid.Row="1"
          x:Name="HistoryList"
          ItemsSource="{x:Bind ViewModel.Source, Mode=OneWay}"
          SelectionMode="Single">

			<ListView.ItemsPanel>
				<ItemsPanelTemplate>
					<ItemsStackPanel ItemsUpdatingScrollMode="KeepItemsInView" />
				</ItemsPanelTemplate>
			</ListView.ItemsPanel>

			<ListView.ItemTemplate>
				<DataTemplate x:DataType="models:ItemMetaPayload">
					<Grid Padding="12"
                  BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                  BorderThickness="1"
                  CornerRadius="4"
                  Margin="0,4">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto"/>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>

						<FontIcon Glyph="&#xE8C8;"
                          FontSize="24"
                          Margin="0,0,12,0"
                          VerticalAlignment="Center"/>

						<StackPanel Grid.Column="1" VerticalAlignment="Center">
							<TextBlock Text="{x:Bind Preview.Text, TargetNullValue='(No preview)'}"
                               Style="{ThemeResource BodyStrongTextBlockStyle}"
                               MaxLines="2"
                               TextTrimming="CharacterEllipsis"/>

							<StackPanel Orientation="Horizontal" Spacing="8">
								<TextBlock Text="{x:Bind Kind}"
                                   Style="{ThemeResource CaptionTextBlockStyle}"
                                   Opacity="0.6"/>
								<TextBlock Text="â€¢"
                                   Style="{ThemeResource CaptionTextBlockStyle}"
                                   Opacity="0.6"/>
								<TextBlock Text="{x:Bind CreatedTsMs}"
                                   Style="{ThemeResource CaptionTextBlockStyle}"
                                   Opacity="0.6"/>
							</StackPanel>
						</StackPanel>

						<Button Grid.Column="2"
								l:Uids.Uid="HistoryPage_CopyButton"
								VerticalAlignment="Center"
								Margin="8,0,0,0"
								Click="CopyButton_Click"/>
					</Grid>
				</DataTemplate>
			</ListView.ItemTemplate>
		</ListView>

	</Grid>
</Page>
